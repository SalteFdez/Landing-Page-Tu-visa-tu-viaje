---
// CTASection.astro
---

<section class="w-full py-16 md:py-24 bg-gradient-to-r from-[#E9744C] via-[#EFA297] to-[#327BA8] relative overflow-hidden">
  <!-- Elementos decorativos de fondo -->
  <div class="absolute inset-0">
    <div class="absolute top-10 left-10 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
    <div class="absolute bottom-10 right-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-60 h-60 bg-white/5 rounded-full blur-3xl"></div>
  </div>

  <div class="container mx-auto px-4 md:px-6 relative z-10">
    <div class="max-w-4xl mx-auto text-center">
      <!-- Header -->
      <div class="mb-12">
        <h2 class="cta-title text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6 leading-tight">
          Â¿Listo para comenzar tu 
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-white to-[#F9E9D8]">aventura?</span>
        </h2>
        
        <p class="text-xl md:text-2xl text-white/90 max-w-3xl mx-auto leading-relaxed">
          Dejanos tu email y te contactaremos en menos de 24 horas para ayudarte a planificar tu viaje perfecto.
        </p>
      </div>

      <!-- Formulario -->
      <div class="cta-form bg-white/10 backdrop-blur-lg rounded-3xl p-8 md:p-12 border border-white/20 max-w-2xl mx-auto">
        <form id="ctaForm" class="space-y-6">
          <div class="space-y-4">
            <div class="relative">
              <input
                type="email"
                name="email"
                id="email"
                required
                placeholder="Tu email"
                class="w-full px-6 py-4 bg-white/20 backdrop-blur-sm border-2 border-white/30 rounded-xl text-white placeholder-white/70 focus:outline-none focus:border-white/50 focus:bg-white/30 transition-all duration-300"
              />
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <span class="text-white/50">ðŸ“§</span>
              </div>
            </div>
            
            <div class="relative">
              <input
                type="text"
                name="name"
                id="name"
                placeholder="Tu nombre (opcional)"
                class="w-full px-6 py-4 bg-white/20 backdrop-blur-sm border-2 border-white/30 rounded-xl text-white placeholder-white/70 focus:outline-none focus:border-white/50 focus:bg-white/30 transition-all duration-300"
              />
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <span class="text-white/50">ðŸ‘¤</span>
              </div>
            </div>
          </div>
          
          <input
            type="hidden"
            name="_subject"
            value="Solicitud de contacto desde el sitio web"
          />
          
          <button
            type="submit"
            id="submitBtn"
            class="w-full bg-white text-[#E9744C] px-8 py-4 rounded-xl font-bold text-lg hover:bg-gray-100 transition-all duration-300 transform hover:scale-105 hover:shadow-2xl group relative overflow-hidden"
          >
            <span class="relative z-10">Â¡Comenzar mi viaje!</span>
            <div class="absolute inset-0 bg-gradient-to-r from-[#E9744C]/10 to-[#EFA297]/10 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"></div>
          </button>
        </form>
        
        <!-- Mensaje de Ã©xito -->
        <div id="successMessage" class="hidden text-center">
          <div class="mb-4">
            <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
              <span class="text-white text-2xl">âœ“</span>
            </div>
            <h3 class="text-2xl font-bold text-white mb-2">Â¡Gracias!</h3>
            <p class="text-white/90">Te contactaremos pronto para ayudarte con tu viaje.</p>
          </div>
        </div>
        
        <!-- Mensaje de error -->
        <div id="errorMessage" class="hidden text-center">
          <div class="mb-4">
            <div class="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
              <span class="text-white text-2xl">âš </span>
            </div>
            <h3 class="text-2xl font-bold text-white mb-2">Oops...</h3>
            <p class="text-white/90">Hubo un problema. Por favor, intentÃ¡ de nuevo.</p>
          </div>
        </div>
        
        <p class="text-sm text-white/70 mt-6">
          <span class="inline-block mr-2">ðŸ”’</span>
          Tus datos estÃ¡n seguros. No compartimos tu informaciÃ³n.
        </p>
      </div>

      <!-- CaracterÃ­sticas adicionales -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-16">
        <div class="text-center">
          <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mx-auto mb-4">
            <span class="text-white text-xl">âš¡</span>
          </div>
          <h4 class="text-white font-semibold mb-2">Respuesta rÃ¡pida</h4>
          <p class="text-white/70 text-sm">Te contactamos en menos de 24 horas</p>
        </div>
        
        <div class="text-center">
          <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mx-auto mb-4">
            <span class="text-white text-xl">ðŸŽ¯</span>
          </div>
          <h4 class="text-white font-semibold mb-2">AsesorÃ­a personalizada</h4>
          <p class="text-white/70 text-sm">Cada viaje es Ãºnico, cada plan tambiÃ©n</p>
        </div>
        
        <div class="text-center">
          <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mx-auto mb-4">
            <span class="text-white text-xl">ðŸ’¯</span>
          </div>
          <h4 class="text-white font-semibold mb-2">GarantÃ­a de calidad</h4>
          <p class="text-white/70 text-sm">Miles de viajeros ya confiaron en nosotros</p>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .cta-title {
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 1s ease-out 0.3s forwards;
  }
  
  .cta-form {
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 1s ease-out 0.6s forwards;
  }
  
  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Estilos para el input focus */
  input:focus {
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
  }
  
  /* AnimaciÃ³n de carga del botÃ³n */
  .loading {
    position: relative;
    color: transparent;
  }
  
  .loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 20px;
    height: 20px;
    border: 2px solid #E9744C;
    border-radius: 50%;
    border-top-color: transparent;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    to {
      transform: translate(-50%, -50%) rotate(360deg);
    }
  }
</style>

<script>
  // @ts-nocheck - GSAP estÃ¡ disponible globalmente
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('ctaForm');
    const submitBtn = document.getElementById('submitBtn');
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    
    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Mostrar estado de carga
        submitBtn.classList.add('loading');
        submitBtn.disabled = true;
        
        const formData = new FormData(form);
        
        try {
          const response = await fetch("https://formspree.io/f/xovwrkaq", {
            method: "POST",
            body: formData,
            headers: {
              Accept: "application/json",
            },
          });

          const result = await response.json();

          if (response.ok) {
            // Mostrar mensaje de Ã©xito
            form.style.display = 'none';
            successMessage.classList.remove('hidden');
            
            // Resetear formulario
            form.reset();
          } else {
            // Mostrar mensaje de error
            form.style.display = 'none';
            errorMessage.classList.remove('hidden');
          }
        } catch (error) {
          console.error("Error al enviar:", error);
          // Mostrar mensaje de error
          form.style.display = 'none';
          errorMessage.classList.remove('hidden');
        } finally {
          // Remover estado de carga
          submitBtn.classList.remove('loading');
          submitBtn.disabled = false;
        }
      });
    }
    
    // Animaciones GSAP si estÃ¡ disponible
    if (typeof gsap !== 'undefined') {
      gsap.registerPlugin(ScrollTrigger);
      
      gsap.from('.cta-title', {
        scrollTrigger: {
          trigger: '.cta-title',
          start: 'top 80%',
          end: 'bottom 20%',
          toggleActions: 'play none none reverse'
        },
        y: 50,
        opacity: 0,
        duration: 1,
        ease: 'power3.out'
      });
      
      gsap.from('.cta-form', {
        scrollTrigger: {
          trigger: '.cta-form',
          start: 'top 80%',
          end: 'bottom 20%',
          toggleActions: 'play none none reverse'
        },
        y: 50,
        opacity: 0,
        duration: 1,
        ease: 'power3.out',
        delay: 0.3
      });
    }
  });
</script>
